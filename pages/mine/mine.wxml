<!--pages/mine/mine.wxml-->
<view class="page">
  <scroll-view scroll-y class="scroll-content">
    <!-- 用户信息卡片 -->
    <view class="profile-card">
      <view class="profile-bg"></view>
      <view class="profile-content" wx:if="{{userInfo}}">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="nickname">{{userInfo.nickName}}</text>
          <view class="user-meta">
            <view style="display:inline-flex;align-items:center;gap:4rpx;">
              <icon name="map-pin" size="24" color="#888"></icon>
              <text class="building" wx:if="{{userInfo.building}}">{{userInfo.building}}</text>
              <text class="building" wx:else>未认证楼栋</text>
            </view>
          </view>
        </view>
        <view class="credit-badge">
          <text class="credit-label">信用分</text>
          <text class="credit-score">{{userInfo.credit_score || 100}}</text>
        </view>
      </view>
      <view class="profile-content login-prompt" wx:else bindtap="onLogin">
        <image class="avatar avatar-default" src="/images/avatar-placeholder.png" mode="aspectFill"></image>
        <view class="user-info">
          <text class="nickname">点击登录</text>
          <text class="login-hint">登录后享受完整服务</text>
        </view>
      </view>
    </view>

    <!-- 数据统计 -->
    <view class="stats-card" wx:if="{{userInfo}}">
      <view class="stat-item" bindtap="goMyPublish">
        <text class="stat-num">{{stats.published}}</text>
        <text class="stat-label">发布</text>
      </view>
      <view class="stat-item" bindtap="goMyFav">
        <text class="stat-num">{{stats.favorites}}</text>
        <text class="stat-label">收藏</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.sold}}</text>
        <text class="stat-label">已售</text>
      </view>
      <view class="stat-item">
        <text class="stat-num">{{stats.bought}}</text>
        <text class="stat-label">已买</text>
      </view>
    </view>

    <!-- 功能列表 -->
    <view class="menu-group">
      <view class="menu-title">我的交易</view>
      <view class="menu-item" bindtap="goMyPublish">
        <icon name="package" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">我的发布</text>
        <text class="menu-arrow">›</text>
      </view>
      <view class="menu-item" bindtap="goMyFav">
        <icon name="heart" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">我的收藏</text>
        <text class="menu-arrow">›</text>
      </view>
      <view class="menu-item" bindtap="goMyHelp">
        <icon name="handshake" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">我的帮忙</text>
        <text class="menu-arrow">›</text>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-title">账户设置</view>
      <picker range="{{buildings}}" bindchange="onBuildingChange">
        <view class="menu-item">
          <icon name="home" size="36" color="#333" class="menu-icon-wrap"></icon>
          <text class="menu-text">楼栋认证</text>
          <view class="menu-right">
            <text class="verify-status {{isVerified ? 'verified' : ''}}">{{isVerified ? userInfo.building : '未认证'}}</text>
            <text class="menu-arrow">›</text>
          </view>
        </view>
      </picker>
      <view class="menu-item" bindtap="goCredit">
        <icon name="star" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">我的信用</text>
        <view class="menu-right">
          <text class="credit-level">{{creditLevel}}</text>
          <text class="menu-arrow">›</text>
        </view>
      </view>
      <view class="menu-item" bindtap="goReport">
        <icon name="alert-triangle" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">举报记录</text>
        <text class="menu-arrow">›</text>
      </view>
    </view>

    <view class="menu-group">
      <view class="menu-title">其他</view>
      <view class="menu-item share-wrap">
        <icon name="share" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">分享给邻居</text>
        <text class="menu-arrow">›</text>
        <button class="share-btn-hidden" open-type="share"></button>
      </view>
      <view class="menu-item" bindtap="goFeedback">
        <icon name="lightbulb" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">意见反馈</text>
        <text class="menu-arrow">›</text>
      </view>
      <view class="menu-item" bindtap="goAbout">
        <icon name="clipboard" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">关于我们</text>
        <text class="menu-arrow">›</text>
      </view>
    </view>

    <!-- 管理入口（仅管理员可见） -->
    <view class="menu-group" wx:if="{{isAdmin}}">
      <view class="menu-title">管理</view>
      <view class="menu-item" bindtap="goFeedbackList">
        <icon name="message-circle" size="36" color="#333" class="menu-icon-wrap"></icon>
        <text class="menu-text">用户反馈</text>
        <text class="menu-arrow">›</text>
      </view>
    </view>

    <view style="height: 180rpx;"></view>
  </scroll-view>
</view>
