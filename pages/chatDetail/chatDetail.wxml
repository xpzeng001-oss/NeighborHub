<!--pages/chatDetail/chatDetail.wxml-->
<view class="page">
  <!-- 消息列表 -->
  <scroll-view
    scroll-y
    class="message-list"
    scroll-into-view="{{scrollToView}}"
    scroll-with-animation>

    <!-- 对方消息：头像在左 -->
    <view class="msg-item msg-left" wx:for="{{messages}}" wx:key="id" wx:if="{{item.senderId !== myUserId}}">
      <image class="msg-avatar" src="{{targetAvatarUrl || '/images/avatar-placeholder.png'}}" mode="aspectFill"></image>
      <view class="msg-bubble bubble-other">
        <text>{{item.content}}</text>
      </view>
    </view>

    <!-- 自己消息：头像在右 -->
    <view class="msg-item msg-right" wx:for="{{messages}}" wx:key="id" wx:if="{{item.senderId === myUserId}}">
      <view class="msg-bubble bubble-mine">
        <text>{{item.content}}</text>
      </view>
      <image class="msg-avatar" src="{{item.senderAvatar || '/images/avatar-placeholder.png'}}" mode="aspectFill"></image>
    </view>

    <view id="msg-bottom"></view>
  </scroll-view>

  <!-- 底部输入栏 -->
  <view class="input-bar safe-bottom">
    <input
      class="msg-input"
      placeholder="输入消息..."
      value="{{inputValue}}"
      bindinput="onInputChange"
      bindconfirm="onSend"
      confirm-type="send"
      adjust-position="{{true}}"
      cursor-spacing="20"
    />
    <view class="send-btn {{inputValue ? 'active' : ''}}" bindtap="onSend">
      <text>发送</text>
    </view>
  </view>
</view>
