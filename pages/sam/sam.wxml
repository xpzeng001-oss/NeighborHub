<!--pages/sam/sam.wxml-->
<view class="page">
  <!-- åˆ†ç±»Tab -->
  <view class="sam-tabs">
    <view class="sam-tab {{activeTab === index ? 'active' : ''}}"
          wx:for="{{tabs}}" wx:key="index"
          bindtap="switchTab" data-index="{{index}}">
      {{item}}
    </view>
  </view>

  <scroll-view scroll-y class="scroll-content">
    <view class="order-list">
      <view class="order-card" wx:for="{{filteredList}}" wx:key="id">
        <!-- çŠ¶æ€æ ‡ç­¾ -->
        <view class="card-status status-{{item.status}}">
          <text>{{item.status === 'open' ? 'æ‹¼å•ä¸­' : item.status === 'full' ? 'å·²æˆå›¢' : 'å·²æˆªæ­¢'}}</text>
        </view>

        <!-- å‘èµ·äºº -->
        <view class="card-header">
          <image class="avatar" src="{{item.userAvatar}}" mode="aspectFill"></image>
          <view class="user-info">
            <text class="user-name">{{item.userName}}</text>
            <text class="user-building">{{item.building}}</text>
          </view>
          <text class="time">{{item.createdAt}}</text>
        </view>

        <!-- å†…å®¹ -->
        <text class="card-title">{{item.title}}</text>
        <text class="card-desc line-clamp-2">{{item.description}}</text>

        <!-- æ‹¼å•ä¿¡æ¯ -->
        <view class="info-section">
          <view class="info-row">
            <text class="info-label">æˆªæ­¢æ—¶é—´</text>
            <text class="info-value">{{item.deadline}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">å–è´§æ–¹å¼</text>
            <text class="info-value">{{item.pickupMethod}}</text>
          </view>
          <view class="info-row" wx:if="{{item.minAmount}}">
            <text class="info-label">èµ·æ‹¼é‡‘é¢</text>
            <text class="info-value highlight">Â¥{{item.minAmount}}</text>
          </view>
        </view>

        <!-- å‚ä¸äººæ•°è¿›åº¦ -->
        <view class="progress-section">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.currentCount / item.targetCount * 100}}%"></view>
          </view>
          <text class="progress-text">{{item.currentCount}}/{{item.targetCount}}äººå‚ä¸</text>
        </view>

        <!-- åº•éƒ¨æ“ä½œ -->
        <view class="card-bottom">
          <view class="participant-avatars">
            <image class="p-avatar" wx:for="{{item.participants}}" wx:key="*this" wx:for-item="p" src="{{p}}"></image>
          </view>
          <button class="btn-join" bindtap="onJoin" data-id="{{item.id}}"
                  disabled="{{item.status !== 'open'}}">
            {{item.status === 'open' ? 'æˆ‘è¦æ‹¼å•' : item.status === 'full' ? 'å·²æˆå›¢' : 'å·²æˆªæ­¢'}}
          </button>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:if="{{filteredList.length === 0}}">
      <text class="empty-emoji">ğŸ›’</text>
      <text class="empty-text">æš‚æ— æ‹¼å•ï¼Œå¿«æ¥å‘èµ·å§</text>
    </view>
  </scroll-view>

  <!-- å‘èµ·æ‹¼å•æŒ‰é’® -->
  <view class="fab-btn" bindtap="goPublish">
    <text class="fab-icon">+</text>
  </view>
</view>
