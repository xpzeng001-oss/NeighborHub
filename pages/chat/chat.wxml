<!--pages/chat/chat.wxml-->
<view class="page">
  <!-- 空状态 -->
  <view class="empty" wx:if="{{!loading && conversations.length === 0}}">
    <icon name="message-circle" size="80" color="#ddd"></icon>
    <text class="empty-text">暂无消息</text>
  </view>

  <!-- 会话列表 -->
  <scroll-view scroll-y class="conversation-list" wx:else>
    <view class="conversation-item"
      wx:for="{{conversations}}" wx:key="id"
      bindtap="goChat"
      data-id="{{item.id}}"
      data-user-id="{{item.targetUser.id}}"
      data-nick-name="{{item.targetUser.nickName}}"
      data-avatar-url="{{item.targetUser.avatarUrl}}">
      <view class="avatar-wrap">
        <image class="avatar" src="{{item.targetUser.avatarUrl || '/images/avatar-placeholder.png'}}" mode="aspectFill"></image>
        <view class="unread-dot" wx:if="{{item.unreadCount > 0}}">
          <text>{{item.unreadCount > 99 ? '99+' : item.unreadCount}}</text>
        </view>
      </view>
      <view class="conv-content">
        <view class="conv-top">
          <text class="conv-name">{{item.targetUser.nickName || '微信用户'}}</text>
          <text class="conv-time">{{item.lastMessageAt}}</text>
        </view>
        <text class="conv-last">{{item.lastMessage || '暂无消息'}}</text>
      </view>
    </view>
  </scroll-view>
</view>
