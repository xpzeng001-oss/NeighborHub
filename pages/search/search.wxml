<!--pages/search/search.wxml-->
<view class="page">
  <!-- 搜索栏 -->
  <view class="search-header">
    <view class="search-input-wrap">
      <icon name="search" size="32" color="#bbb"></icon>
      <input class="search-input" placeholder="搜索闲置好物" focus auto-focus
             bindinput="onSearchInput" bindconfirm="onSearch" value="{{keyword}}"/>
      <view class="clear-btn" wx:if="{{keyword}}" bindtap="clearKeyword">
        <icon name="x" size="28" color="#ccc"></icon>
      </view>
    </view>
    <text class="cancel-btn" bindtap="goBack">取消</text>
  </view>

  <!-- 搜索历史 -->
  <view class="history-section" wx:if="{{!keyword && searchHistory.length > 0}}">
    <view class="section-header">
      <text class="section-title">搜索历史</text>
      <text class="clear-history" bindtap="clearHistory">清除</text>
    </view>
    <view class="history-tags">
      <view class="history-tag" wx:for="{{searchHistory}}" wx:key="*this" bindtap="onHistoryTap" data-keyword="{{item}}">
        {{item}}
      </view>
    </view>
  </view>

  <!-- 热门搜索 -->
  <view class="hot-section" wx:if="{{!keyword}}">
    <text class="section-title">热门搜索</text>
    <view class="hot-list">
      <view class="hot-item" wx:for="{{hotKeywords}}" wx:key="*this" bindtap="onHistoryTap" data-keyword="{{item}}">
        <text class="hot-rank {{index < 3 ? 'top' : ''}}">{{index + 1}}</text>
        <text>{{item}}</text>
      </view>
    </view>
  </view>

  <!-- 搜索结果 -->
  <view class="results" wx:if="{{keyword && searched}}">
    <view class="result-count" wx:if="{{results.length > 0}}">
      找到 {{results.length}} 个结果
    </view>
    <view class="result-list">
      <view class="result-item" wx:for="{{results}}" wx:key="id" bindtap="goDetail" data-id="{{item.id}}">
        <image class="result-img" src="{{item.images[0]}}" mode="aspectFill"></image>
        <view class="result-info">
          <text class="result-title">{{item.title}}</text>
          <text class="result-price" wx:if="{{!item.isFree}}">¥{{item.price}}</text>
          <text class="result-price free" wx:else>免费自取</text>
          <text class="result-meta">{{item.building}} · {{item.condition}}</text>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:if="{{results.length === 0}}">
      <icon name="search" size="96" color="#ccc"></icon>
      <text class="text">未找到相关物品</text>
    </view>
  </view>
</view>
