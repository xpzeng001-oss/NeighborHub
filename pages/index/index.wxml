<!--pages/index/index.wxml-->
<view class="page">
  <!-- é¡¶éƒ¨æ¸å˜åŒºåŸŸï¼ˆå«bannerï¼‰ -->
  <view class="top-gradient" style="padding-top: {{statusBarHeight}}px;">
    <view class="header" style="height: {{headerHeight}}px; padding-right: {{menuWidth}}px;">
      <view class="community-select" bindtap="onCommunityTap">
        <text class="community-name">{{currentCommunity}}</text>
        <text class="arrow">â–¾</text>
      </view>
      <view class="search-bar" bindtap="goSearch">
        <icon name="search" size="32" color="#888"></icon>
        <text class="search-placeholder">æœç´¢é—²ç½®å¥½ç‰©...</text>
      </view>
    </view>
    <!-- å¹¿å‘Šè½®æ’­ -->
    <view class="banner-wrap">
      <swiper class="banner-swiper" indicator-dots autoplay interval="4000" circular>
        <swiper-item wx:for="{{banners}}" wx:key="id">
          <image class="banner-img" src="{{item.image}}" mode="aspectFill"></image>
        </swiper-item>
      </swiper>
    </view>
  </view>

  <scroll-view scroll-y class="scroll-content" refresher-enabled="{{true}}" bindrefresherrefresh="onRefresh" refresher-triggered="{{isRefreshing}}">

    <!-- å¿«æ·å…¥å£ -->
    <view class="quick-entry">
      <view class="entry-item" bindtap="goForum">
        <text class="entry-emoji">ğŸ’¬</text>
        <text class="entry-label">æ¥¼é‡Œäº‹å„¿</text>
      </view>
      <view class="entry-item" bindtap="goHelp">
        <text class="entry-emoji">ğŸ¤</text>
        <text class="entry-label">é‚»é‡Œå¸®å¿™</text>
      </view>
      <view class="entry-item" bindtap="goRental">
        <text class="entry-emoji">ğŸ </text>
        <text class="entry-label">æˆ¿å±‹ç§Ÿèµ</text>
      </view>
      <view class="entry-item" bindtap="goPet">
        <text class="entry-emoji">ğŸ¾</text>
        <text class="entry-label">å® ç‰©å–‚å…»</text>
      </view>
      <view class="entry-item" bindtap="goSam">
        <text class="entry-emoji">ğŸ›’</text>
        <text class="entry-label">å±±å§†æ‹¼å•</text>
      </view>
    </view>

    <!-- å†…å®¹Tab + åˆ†ç±»ç­›é€‰ -->
    <view class="tab-bar-wrap">
      <scroll-view scroll-x class="tab-scroll">
        <view class="tab-list">
          <view class="tab-item {{activeTab === index ? 'active' : ''}}"
                wx:for="{{tabs}}" wx:key="index"
                bindtap="onTabChange" data-index="{{index}}">
            <text>{{item}}</text>
            <view class="tab-line" wx:if="{{activeTab === index}}"></view>
          </view>
        </view>
      </scroll-view>
      <!-- åˆ†ç±»ç­›é€‰ï¼ˆé—²ç½®ç‰©å“tabä¸‹ï¼‰ -->
      <scroll-view scroll-x class="category-scroll" wx:if="{{activeTab === 0}}">
        <view class="category-list">
          <view class="capsule-tab {{activeCategory === item.id ? 'active' : ''}}"
                wx:for="{{categories}}" wx:key="id"
                bindtap="onCategoryChange" data-id="{{item.id}}">
            <text>{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- å•†å“ç€‘å¸ƒæµ -->
    <view class="product-grid">
      <view class="grid-column">
        <view class="product-card" wx:for="{{leftProducts}}" wx:key="id" bindtap="goDetail" data-id="{{item.id}}">
          <view class="card-image">
            <image src="{{item.images[0]}}" mode="aspectFill" class="product-img"></image>
            <view class="free-badge" wx:if="{{item.isFree}}">å…è´¹</view>
          </view>
          <view class="card-info">
            <text class="product-title line-clamp-2">{{item.title}}</text>
            <view class="price-row">
              <text class="price" wx:if="{{!item.isFree}}">Â¥{{item.price}}</text>
              <text class="price free-price" wx:else>å…è´¹è‡ªå–</text>
              <text class="original-price" wx:if="{{item.originalPrice > 0 && !item.isFree}}">Â¥{{item.originalPrice}}</text>
            </view>
            <view class="card-footer">
              <text class="seller-info">{{item.building}}</text>
              <text class="want-count">{{item.wantCount}}äººæƒ³è¦</text>
            </view>
          </view>
        </view>
      </view>
      <view class="grid-column">
        <view class="product-card" wx:for="{{rightProducts}}" wx:key="id" bindtap="goDetail" data-id="{{item.id}}">
          <view class="card-image">
            <image src="{{item.images[0]}}" mode="aspectFill" class="product-img"></image>
            <view class="free-badge" wx:if="{{item.isFree}}">å…è´¹</view>
          </view>
          <view class="card-info">
            <text class="product-title line-clamp-2">{{item.title}}</text>
            <view class="price-row">
              <text class="price" wx:if="{{!item.isFree}}">Â¥{{item.price}}</text>
              <text class="price free-price" wx:else>å…è´¹è‡ªå–</text>
              <text class="original-price" wx:if="{{item.originalPrice > 0 && !item.isFree}}">Â¥{{item.originalPrice}}</text>
            </view>
            <view class="card-footer">
              <text class="seller-info">{{item.building}}</text>
              <text class="want-count">{{item.wantCount}}äººæƒ³è¦</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <view class="load-more" wx:if="{{!hasMore}}">â€” æ²¡æœ‰æ›´å¤šäº† â€”</view>
    <view style="height: 160rpx;"></view>
  </scroll-view>
</view>

<!-- å°åŒºé€‰æ‹©å¼¹çª— -->
<view class="modal-mask" wx:if="{{showCommunityPicker}}" bindtap="closePicker">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©å°åŒº</text>
      <view class="modal-close" bindtap="closePicker">
        <icon name="x" size="36" color="#999"></icon>
      </view>
    </view>
    <view class="community-list">
      <view class="community-option {{item.name === currentCommunity ? 'selected' : ''}}"
            wx:for="{{communities}}" wx:key="id"
            bindtap="selectCommunity" data-item="{{item}}">
        <text>{{item.name}}</text>
        <icon wx:if="{{item.name === currentCommunity}}" name="check" size="32" color="#7A9900"></icon>
      </view>
    </view>
  </view>
</view>
